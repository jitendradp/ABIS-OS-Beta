# An entity to login a person to the system
type User {
	id: ID! @id @unique
	createdAt: DateTime! @createdAt
	updatedAt: DateTime @updatedAt
	parent: User                                            # A user that has invited this user to the system
	first_name: String!                                     # The first name of the person
	last_name: String!										# The family name of the person
	timezone: String!										# The user's local timezone
	email: String! @unique									# Common digital identity
	mobile_phone: String                                    # Adding a second information for the identity
	password_salt: String!									# Adding a random string to the password hash
	password_hash: String!									# A Fully hashed password including salt e.g. bcrypt
	is_verified: Boolean!									# The user's email address was verified or not
	challenge: String       								# An additional string for e.g. verify email, second login factor etc.
	profiles: [Profile!]!									# The type of the user's profiles for billing
	sessions: [Session!]!                                   # Links to the sessions generated by this user
	last_used_profile: String                               # The last used profile id to active that profile after the login
}

type Session {
	id: ID! @id @unique
	createdAt: DateTime! @createdAt
	updatedAt: DateTime @updatedAt
	csrfToken: String! @unique
	authToken: String! @unique
	validTo: DateTime!
	timedOut: DateTime
	loggedOut: DateTime
	user: User!                                             # The logged-in user
	profile: Profile                                        # Each session can have an associated profile
	location: Location										# A location in the real world to identify where the user has logged in from
	last_ip_address: String                                 # The ip address that last used this session
}

# Represents an user or bot in groups
type Profile {
	id: ID! @id @unique
	createdAt: DateTime! @createdAt
	updatedAt: DateTime @updatedAt
	creator: User!                                          # The user that created the profile
	name: String!											# The profile's name that is displayed in groups
	timezone: String										# The profile's local timezone can be overwritten from the user timezone here
	status: StatusType!                                     # Every profile has a current status
	type: ProfileType!                                      # The user can set a type for this profile
	is_hidden: Boolean!	                                    # If true, then the profile can't be found within the global search
	is_bot: Boolean!                                        # Indicates if the profile is a human or machine
	slogan: String											# A slogan of the profile that is displayed in groups
	picture: String!										# The url of a path to an image file
	memberships: [Membership!]! 							# The memberships of that profile in groups
}

enum StatusType {
	Busy											        # The profile is available but notification is turned off
	Offline					    							# The profile is offline so not reachable
	Online											        # The profile is online and reachable
	Away												    # The profile is off the keyboard but notification is turned on
}

enum ProfileType {
	Work											        # A work profile costs a monthly licensing fee
	Private					    							# A private profile is free of charge
}

# A profile is participating in a group
type Membership {
	id: ID! @id @unique
	createdAt: DateTime! @createdAt
	updatedAt: DateTime @updatedAt
	parent: Membership                                      # A profile that has invited this profile to a group
	can_read: Boolean!                                      # The profile can read and access resources from that group
	can_write: Boolean!                                     # The profile can write on that group
	can_delete: Boolean!                                    # The profile can delete items in that group or the group
	member: Profile!                                        # The profile either bot or human
	group: Group!											# The group where the profile is a member of
	group_pinned: Boolean!                                  # The member could pin a group to the top
	show_history: Boolean!									# To show a new member the history of messages
	has_left: Boolean!                                      # If the profile left a group
	has_joined: Boolean!                                    # If an invited profile has joined the group
}

# Groups resources, events and messages around profiles
type Group {
	id: ID! @id @unique
	createdAt: DateTime! @createdAt
	updatedAt: DateTime @updatedAt
	creator: Profile!										# The host profile of the group
	name: String!											# The name of the group
	title: String											# A prominent title what the group is about
	description: String  									# A short description what the group is about
	logo: String											# The url to an image file that makes it easier to recognize the group
    type: GroupType!									    # Different types of groups
	parent: Group											# A group that has no parent is root
	is_hidden: Boolean!										# When true, the group is invisible for all other profiles outside that group
	is_public: Boolean!										# When true, any profile outside that group is allowed to join it
	members: [Membership!]!									# Profiles that are participating in that group
	messages: [Message!]!									# Events with a specific content
	tags: [Tag!]!											# Meta information as hashes to classify the object
	location: Location										# A location in the real world
	members_count: Int!                                     # The number of total members in that group
	members_online: Int!                                    # The number of actual members that are online right now
	messages_count: Int!                                    # The number of the total messages that have been sent in that group
}

enum GroupType {
	ROOM					    							# A chat room that hosts a group of people and conversations
    CHANNEL                                                 # Groups messages and events around at least two profiles
	THREAD												    # Groups messages around a specific conversation in a channel
	CONTACTS												# Groups contacts of a profile
	FOLLOWERS                                               # Groups followers of a profile
}

type Tag {
   	id: ID! @id @unique
   	createdAt: DateTime! @createdAt
	creator: Profile!										# The profile who created the tag
   	name: String!                                           # The tag content itself
   	parent: Tag                                             # A parent tag to build some hierarchie
}

type Location {
	id: ID! @id @unique
	createdAt: DateTime! @createdAt
	updatedAt: DateTime! @updatedAt							# Every location was uniquely tagged by someone
	creator: Profile!										# The profile who created the location
	type: LocationType!										# If the place is a concept of a place (e.g. someones address) or the real thing (a place on earth; maybe in space soon ;)
	name: String											# A name that was given for a certain location
	category: String                                        # For example a park, restaurant, school, etc.
	address: String                                         # The official address of that location
	zip_code: String                                        # The official zip code of that location
	city: String                                            # The official name of the city that owns this district
	country: String                                         # The country that owns that location
	continent: String                                       # The continent where the country is located
	latitude: Float!										# Locates a point on a map from north to south
	longitude: Float!										# Locates a point on a map from east to west
	radius_meter: Float										# The radius from the center of the location in meters
	tags: [Tag!]!											# Meta information as hashes to classify the object
	visitors_count: Int!                                    # The total number of users that have visited this location
}

enum LocationType {
    GEOGRAPHIC,
    POI
}

## todo how could a message be pinned to a conversation by a specific profile?
# Any content that was sent from a creator to a recipient
type Message {
	id: ID! @id @unique
	createdAt: DateTime! @createdAt
	updatedAt: DateTime @updatedAt
	creator: Profile!										# The profile who created the message
	type: MessageType!										# Indicates the purpose of the message
	parent: Message 										# A previous event, if not then root
	subject: String											# A human readable subject for a message
	content: Json											# The content of a message can be anything or empty
	attachments: [Attachment!]!								# A url to a file that is attached to the message
	reactions: [Reaction!]!									# A event can trigger multiple reactions such as likes
	tags: [Tag!]!											# Meta information as hashes to classify the object
}

# All data exchanged is expressed as an "event"
enum MessageType {
	NOTIFICATION											# A prominent information that is pushed to the user
	DIRECT_MESSAGE											# The user profiles receives a direct chat message
	COMMENT												    # A message as comment on another message within a thread
	POST												    # Drops a message on a channel e.g. newsfeed
}

# Profiles can react on messages
type Reaction {
	id: ID! @id @unique
	createdAt: DateTime! @createdAt
	updatedAt: DateTime @updatedAt
	creator: Profile!										# The profile who reacted on some event
	emoji: String!											# A symbol to express an emotion
}

# Something that can be attached to a message
type Attachment {
	id: ID! @id @unique
	createdAt: DateTime! @createdAt
	updatedAt: DateTime @updatedAt
	creator: Profile!										# The profile who created the attachment
	name: String!											# The name of the attached object
	type: AttachmentType!									# Categorizes the attachment
	link: String											# The unique url to access the attached object
	tags: [Tag!]!											# Meta information as hashes to classify the object
}

# Classifies the attached file
enum AttachmentType {
	DOCUMENT											    # Could be a flat file or pdf that was uploaded
	PICTURE												    # Could be a chart visualization rendered a picture
	LINK												    # Could a link that was posted in the message's content
	VIDEO												    # Could be a video that was added to the content
	AUDIO												    # Could be a voice memo that was added to the content
}
